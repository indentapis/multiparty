import { readdir, readFile } from 'fs/promises'
import { SimulatorClient } from './simulator-client'
import { Press_Start_2P } from 'next/font/google'
import { ThemeToggle } from './theme-toggle'

const font = Press_Start_2P({ weight: '400', subsets: ['latin'] })

export default async function Home() {
  const dirname = process.cwd() + '/src/app/testdata/'
  const files = await readdir(dirname)
  const examplePolicies = (
    await Promise.all(
      files.map(async (filename) => {
        return {
          [filename.split('.')[0]]: (await readFile(dirname + filename, 'utf8')),
        }
      })
    )
  ).reduce((acc, cur) => ({ ...acc, ...cur }), {})
  return (
    <main className="flex flex-col h-screen w-full p-8">
      <div className="flex pb-1.5 space-x-2 items-center">
        <h1
          className="group inline-flex items-center cursor-pointer relative z-20"
          style={{ letterSpacing: '-0.4px' }}
        >
          <Logo height={24} />
          <span
            className={
              'text-[14px] dark:text-green-500 dark:group-hover:text-white dark:group-hover:[text-shadow:_0_1px_3px_rgb(255,255,255)_/_15%)] group-hover:text-green-500 group-hover:[text-shadow:_0_1px_3px_rgb(0_0_0_/_15%)] transition-all uppercase ' +
              font.className
            }
          >
            <span style={{ letterSpacing: '-2px' }}>S</span>
            <span style={{ letterSpacing: '-0.45px' }}>
              imul<span style={{ letterSpacing: '-4px' }}>a</span>tor
            </span>
          </span>
        </h1>
        <span className="relative z-20">
          <ThemeToggle />
        </span>
      </div>
      <div className="flex-1 w-full">
        <SimulatorClient examplePolicies={examplePolicies} />
      </div>
    </main>
  )
}

function Logo({
  iconOnly = false,
  textOnly = false,
  dark = false,
  height = 43,
  className = '',
  ...props
}) {
  return (
    <svg
      height={height}
      viewBox={
        textOnly ? '36 -8 158 52' : `0 0 ${iconOnly ? '36 36' : '198 43'}`
      }
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
      className={className}
    >
      {!iconOnly && (
        <path
          d="M50.594 31.76l-9.4-25.04h-.16c.054.533.094 1.213.12 2.04.054.826.094 1.733.12 2.72.027.96.04 1.946.04 2.96v17.32h-3.32V3.2h5.32l8.8 23.4h.16l8.96-23.4h5.28v28.56h-3.56V14.2c0-.934.014-1.854.04-2.76.027-.934.067-1.8.12-2.6.054-.827.094-1.52.12-2.08h-.16l-9.52 25h-2.96zm36.33-21.44v21.44h-2.88l-.52-2.84h-.16a5.803 5.803 0 01-1.76 1.84c-.72.48-1.507.826-2.36 1.04-.854.24-1.747.36-2.68.36-1.707 0-3.147-.267-4.32-.8a5.625 5.625 0 01-2.6-2.56c-.587-1.147-.88-2.627-.88-4.44V10.32h3.56v13.8c0 1.706.386 2.986 1.16 3.84.773.853 1.973 1.28 3.6 1.28 1.6 0 2.853-.294 3.76-.88.933-.614 1.586-1.494 1.96-2.64.4-1.174.6-2.587.6-4.24V10.32h3.52zm5.526 21.44h-3.52V1.36h3.52v30.4zm9.552-2.48c.534 0 1.08-.04 1.64-.12.56-.107 1.014-.214 1.36-.32v2.68c-.373.186-.906.333-1.6.44-.693.133-1.36.2-2 .2-1.12 0-2.16-.187-3.12-.56-.933-.4-1.693-1.08-2.28-2.04-.586-.96-.88-2.307-.88-4.04V13.04h-3.04v-1.68l3.08-1.4 1.4-4.56h2.08v4.92h6.2v2.72h-6.2v12.4c0 1.306.307 2.28.92 2.92.64.613 1.454.92 2.44.92zm6.013-18.96v21.44h-3.52V10.32h3.52zm-1.72-8.04c.534 0 1 .186 1.4.56.427.346.64.906.64 1.68 0 .746-.213 1.306-.64 1.68-.4.373-.866.56-1.4.56-.586 0-1.08-.187-1.48-.56-.4-.374-.6-.934-.6-1.68 0-.774.2-1.334.6-1.68.4-.374.894-.56 1.48-.56zm13.913 7.64c2.64 0 4.76.92 6.36 2.76 1.627 1.84 2.44 4.613 2.44 8.32 0 2.426-.373 4.48-1.12 6.16-.72 1.653-1.747 2.906-3.08 3.76-1.307.826-2.853 1.24-4.64 1.24-1.093 0-2.067-.147-2.92-.44-.853-.294-1.587-.667-2.2-1.12-.587-.48-1.093-1-1.52-1.56h-.24c.053.453.107 1.026.16 1.72.053.693.08 1.293.08 1.8v8.8h-3.52V10.32h2.88l.48 2.92h.16a9.026 9.026 0 011.52-1.68 7.057 7.057 0 012.16-1.2c.853-.294 1.853-.44 3-.44zm-.64 2.96c-1.44 0-2.6.28-3.48.84-.88.533-1.52 1.346-1.92 2.44-.4 1.093-.613 2.48-.64 4.16V21c0 1.76.187 3.253.56 4.48.373 1.226 1 2.16 1.88 2.8.907.64 2.133.96 3.68.96 1.307 0 2.373-.36 3.2-1.08.853-.72 1.48-1.694 1.88-2.92.427-1.254.64-2.68.64-4.28 0-2.454-.48-4.414-1.44-5.88-.933-1.467-2.387-2.2-4.36-2.2zm20.369-2.92c2.614 0 4.547.573 5.8 1.72 1.254 1.146 1.88 2.973 1.88 5.48v14.6h-2.56l-.68-3.04h-.16a12.177 12.177 0 01-1.92 1.96c-.64.506-1.386.88-2.24 1.12-.826.24-1.84.36-3.04.36-1.28 0-2.44-.227-3.48-.68a5.36 5.36 0 01-2.4-2.08c-.586-.96-.88-2.16-.88-3.6 0-2.134.84-3.774 2.52-4.92 1.68-1.174 4.267-1.814 7.76-1.92l3.64-.12v-1.28c0-1.787-.386-3.027-1.16-3.72-.773-.694-1.866-1.04-3.28-1.04a9.82 9.82 0 00-3.2.52c-1.013.32-1.96.693-2.84 1.12l-1.08-2.64c.934-.507 2.04-.934 3.32-1.28 1.28-.374 2.614-.56 4-.56zm1.04 11.44c-2.666.106-4.52.533-5.56 1.28-1.013.746-1.52 1.8-1.52 3.16 0 1.2.36 2.08 1.08 2.64.747.56 1.694.84 2.84.84 1.814 0 3.32-.494 4.52-1.48 1.2-1.014 1.8-2.56 1.8-4.64v-1.92l-3.16.12zm19.262-11.48c.4 0 .827.026 1.28.08.48.026.894.08 1.24.16l-.44 3.24c-.346-.08-.733-.147-1.16-.2a8.76 8.76 0 00-1.16-.08c-.826 0-1.613.173-2.36.52a6.306 6.306 0 00-2 1.48c-.586.613-1.053 1.36-1.4 2.24-.32.88-.48 1.866-.48 2.96v11.44h-3.52V10.32h2.88l.4 3.92h.16c.454-.8 1-1.52 1.64-2.16a7.054 7.054 0 012.2-1.56c.827-.4 1.734-.6 2.72-.6zm7.684 19.36c.533 0 1.08-.04 1.64-.12.56-.107 1.013-.214 1.36-.32v2.68c-.374.186-.907.333-1.6.44-.694.133-1.36.2-2 .2-1.12 0-2.16-.187-3.12-.56-.934-.4-1.694-1.08-2.28-2.04-.587-.96-.88-2.307-.88-4.04V13.04h-3.04v-1.68l3.08-1.4 1.4-4.56h2.08v4.92h6.2v2.72h-6.2v12.4c0 1.306.306 2.28.92 2.92.64.613 1.453.92 2.44.92zm.733-18.96h3.76l4.64 12.2c.266.72.506 1.413.72 2.08.24.666.453 1.32.64 1.96.186.613.333 1.213.44 1.8h.16c.16-.667.413-1.534.76-2.6.346-1.094.706-2.187 1.08-3.28l4.36-12.16h3.8l-9.24 24.4c-.507 1.333-1.107 2.493-1.8 3.48-.667 1.013-1.494 1.786-2.48 2.32-.96.56-2.134.84-3.52.84-.64 0-1.2-.04-1.68-.12-.48-.054-.894-.12-1.24-.2v-2.8c.293.053.64.106 1.04.16.426.053.866.08 1.32.08.826 0 1.533-.16 2.12-.48a4.11 4.11 0 001.56-1.32c.426-.56.786-1.227 1.08-2l1.12-2.84-8.64-21.52z"
          className="dark:fill-white fill-[#070A29]"
        />
      )}
      {!textOnly && (
        <g
          className="group-hover:animate-spin origin-center"
          style={{ transformBox: 'fill-box' }}
        >
          <circle cx={18.4988} cy={17.4207} r={12.7906} fill="#122E55" />
          <path
            d="M12.82 5.962A7.65 7.65 0 0118.5 17.38a7.65 7.65 0 00-12.727-.794c.287-4.662 3.079-8.647 7.046-10.624z"
            fill="#122E55"
          />
          <path
            d="M5.773 16.586a7.65 7.65 0 0112.726.794 7.65 7.65 0 00-7.05 10.625 12.738 12.738 0 01-5.676-11.419z"
            fill="#2F80ED"
          />
          <path
            d="M11.449 28.005a7.65 7.65 0 017.05-10.625 7.65 7.65 0 005.68 11.418 12.697 12.697 0 01-5.68 1.332 12.69 12.69 0 01-7.05-2.125z"
            fill="#1C4C8B"
          />
          <path
            d="M24.178 28.798a7.65 7.65 0 01-5.68-11.418 7.65 7.65 0 0012.727.794c-.287 4.662-3.079 8.647-7.047 10.624z"
            fill="#122E55"
          />
          <path
            d="M31.224 18.174a7.65 7.65 0 01-12.726-.794 7.65 7.65 0 007.05-10.625 12.738 12.738 0 015.677 11.42z"
            fill="#2F80ED"
          />
          <path
            d="M25.549 6.755a7.65 7.65 0 01-7.05 10.625 7.65 7.65 0 00-5.68-11.418A12.697 12.697 0 0118.5 4.63c2.607 0 5.03.782 7.05 2.125z"
            fill="#1C4C8B"
          />
        </g>
      )}
    </svg>
  )
}
